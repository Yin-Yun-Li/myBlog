<script>
  // 放在 head 裡的最前面
  (function() {
    const savedTheme = localStorage.getItem("quarto-color-scheme");
    const systemDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    const isDark = savedTheme === "dark" || (!savedTheme && systemDark);

    if (isDark) {
      // 1. 立即修改 HTML 背景色（最快的方式）
      document.documentElement.style.backgroundColor = "#1a1a1a";
      // 2. 注入一塊臨時的 CSS 到 head 中，強制所有元素在載入前背景都是黑的
      const style = document.createElement('style');
      style.innerHTML = `html, body { background-color: #1a1a1a !important; color: #d1d1d1; }`;
      style.id = 'early-dark-mode-fix';
      document.head.appendChild(style);
    }
  })();
</script>